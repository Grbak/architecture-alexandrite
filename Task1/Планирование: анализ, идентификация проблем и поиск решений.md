# Планирование: анализ, идентификация проблем и поиск решений

### Cуществующие и потенциальные проблемы

- ежемесячно увеличивающаяся нагрузка приводит к накоплению очередей на расчет стоимости по 3D-модели, из-за чего время ожидания для конечного пользователя постепенно увеличивается (кажется, что после расчета стоимости заказа пользователь должен подтвердить его оформление, но, судя по заданию, он сразу же создается в CRM, поэтому очереди на расчет стоимости тормозят все бизнес-процессы);
- сервисы развернуты в единичных экземплярах, из-за чего подразумевают только вертикальное масштабирование;
- БД развернуты в единичных экземплярах, из-за чего повышается риск потери данных, а также снижается производительность;
- страница списка заказов в MES загружается долго, что ухудшает пользовательский опыт;
- ручной деплой в release- и prod-окружения значительно повышает вероятность ошибок и отказа системы;
- отсутствует наблюдаемость системы.

### Решения существующих и потенциальных проблем

- настроить в EC2 деплой нескольких экземпляров MES API, что позволит справляться с большим количеством заказов без риска значительных задержек, а также совместно с настройкой балансировки нагрузки сделает систему более масшатбируемой;
- настроить репликацию БД, что уменьшит риск потери данных (для простоты можно начать с репликации master-slave, а в дальнейшем для большей надежности использовать репликацию master-master, храня копии кластеров в разных дата-центрах);
- внедрить подход Pipeline as Сode для автоматизации деплоя во всех окружениях, что позволит снизить вероятность ошибок, а также сделает процесс деплоя более прозрачным для всех членов команды;
- добавить кэширование новейших заказов в MES API при запросе их из БД с использованием паттерна read-through, что позволит ускорить их загрузку в веб-интерфейсе;
- внедрить мониторинг и/или логирование для повышения наблюдаемости.

### Приоритизация

Наиболее приоритетными на текущем этапе являются следующие задачи:

1. Горизонтальное масштабирование MES API для решения проблемы больших очередей на расчет стоимости заказа по 3D-модели, так как это уже приводит к тому, что клиенты жалуются на неполучение заказов. Также это позволит частично решить другую проблему – долгая загрузка заказов в интерфейсе, поскольку долгий расчет стоимости будет меньше влиять на доступность другого функционала MES API;
2. Внедрение мониторинга и/или логирования, так как это позволит быстрее реагировать на проблемы пользователей, в том числе в условиях ожидаемого увеличения нагрузки;
3. Репликация БД, так как при текущих масштабах бизнеса потеря всех данных является критичной.

Через полгода ожидается, что:

- текущие критичные проблемы с задержками заказов будут решены, а масштабируемость системы будет позволять справляться с пиковыми нагрузками;
- мониторинг системы настроен таким образом, чтобы можно было более точно оценивать нагрузку и состояние компонентов системы в целом и решать возникающие проблемы до того, как они будут приводить к жалобам пользователей;
- БД будут реплицированы;
- появится четкий план вндерения автоматизации в процесс деплоя на все стенды, а также сроки его реализации.
